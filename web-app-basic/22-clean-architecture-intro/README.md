# Chapter 22: クリーンアーキテクチャ入門

API の規模が大きくなると、「どこに何を書けばいいか分からない」という問題が発生します。それを解決するのが**アーキテクチャ**です。

## 1. なぜアーキテクチャが必要なのか？

初心者のうちは、Hono のルートハンドラーの中に全ての処理（バリデーション、DB操作、計算など）を書きがちです。これを **Fat Controller** と呼びます。

### Fat Controller の問題
- **テストが難しい**: HTTP リクエストを擬似的に送らないとロジックが確認できない。
- **修正が怖い**: 1箇所変えると、思わぬ場所に影響が出る。
- **環境に依存する**: Hono から別のフレームワークに乗り換える時、全てのコードを書き直す必要がある。

## 2. 依存性のルール (Dependency Rule)

クリーンアーキテクチャの核心は、**中心に向かって依存する**ことです。

- **Domain (中心)**: 純粋なビジネスロジック。フレームワークのことは一切知らない。
- **Infrastructure (外側)**: データベース、ライブラリ、Web フレームワーク。一番変わりやすい。

> [!TIP]
> **「ビジネスルール」を「インフラ」から守る**ことが最大の目的です。
> 例えば、「ユーザー登録」というビジネスロジックは、DB が PostgreSQL だろうが MySQL だろうが変わらないはずです。

## 3. このセクションで目指す形

今後、以下の4つのレイヤーに分けてコードを書いていきます。

1. **Entity (Domain)**: データの形と、そのデータに紐づく基本的なルール。
2. **Use Case**: アプリケーションの具体的な機能（〜を登録する、〜を取得する）。
3. **Controller (Adapter)**: HTTP リクエストを Use Case が分かる言葉に翻訳する。
4. **Repository (Infrastructure)**: データベースへの具体的な操作。

## 演習：今の自分のコードを振り返る

これまでに書いた `web-app` のコードを見てみましょう。一つのファイルに色々な責任（URLの定義、データの操作、エラーの返し方）が混ざっていないか確認してください。

次のチャプターから、それらを解きほぐしていきます。
